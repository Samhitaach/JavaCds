import com.tsb.framework.driver.Driver;
import org.openqa.selenium.*;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.ui.*;
import java.time.Duration;
import static org.openqa.selenium.support.ui.ExpectedConditions.*;
public class LoginPage {
    private WebDriver d() { return Driver.get(); }
    private WebDriverWait wait() { return new WebDriverWait(d(), Duration.ofSeconds(15)); }
    private By loginLink()      { return By.linkText("Log in"); }
    private By loginIframe()    { return By.cssSelector("iframe[title='Login']"); } // adjust if needed
    private By emailField()     { return By.cssSelector("input[type='email'], #Email"); }
    private By passwordField()  { return By.cssSelector("input[type='password'], #Password"); }
    private By submitButton()   { return By.cssSelector("button[type='submit'], input[type='submit']"); }
    private By errorBanner()    { return By.cssSelector(".error, .validation-summary-errors"); }
    private By dashboardMarker(){ return By.cssSelector("[data-test='user-menu'], a[title='My Trade Me']"); }
    public void openHome() {
        d().get("https://www.tmsandbox.co.nz/");
        d().manage().window().maximize();
        wait().until(presenceOfElementLocated(By.tagName("body")));
    }
    public void openLoginDialog() {
        WebElement link = wait().until(elementToBeClickable(loginLink()));
        new Actions(d()).moveToElement(link).pause(Duration.ofMillis(100)).click().perform();
        switchToLoginFrameIfPresent();
    }
    public void fillCredentials(String email, String password) {
        switchToLoginFrameIfPresent();
        WebElement emailEl = wait().until(elementToBeClickable(emailField()));
        emailEl.clear(); emailEl.sendKeys(email);
        WebElement pwdEl = wait().until(elementToBeClickable(passwordField()));
        pwdEl.clear(); pwdEl.sendKeys(password);
    }
    public void submitLogin() {
        switchToLoginFrameIfPresent();
        wait().until(elementToBeClickable(submitButton())).click();
    }
    public boolean isLoggedIn() {
        backToDefault();
        try { wait().until(presenceOfElementLocated(dashboardMarker())); return true; }
        catch (TimeoutException e) { return false; }
    }
    public boolean hasLoginError() {
        try { wait().until(visibilityOfElementLocated(errorBanner())); return true; }
        catch (TimeoutException e) { return false; }
    }
    private void switchToLoginFrameIfPresent() {
        d().switchTo().defaultContent();
        try { WebElement frame = wait().until(presenceOfElementLocated(loginIframe()));
              d().switchTo().frame(frame);
        } catch (TimeoutException ignored) {}
    }
    public void backToDefault() {
        try { d().switchTo().defaultContent(); } catch (Exception ignored) {}
    }
}

public  void testCase01(){

        System.out.println("Start Test case: testCase01: Verify the Leetcode Homepage URL");
        
        driver.get("https://leetcode.com/");

        String curUrl = driver.getCurrentUrl();

        if(curUrl.contains("leetcode")){
            System.out.println("TestCase01: Verify that the Leetcode homepage URL contains 'leetcode': PASS");
        }

        else{
            System.out.println("TestCase01: Verify that the Leetcode homepage URL contains 'leetcode': FAIL");
        }

        System.out.println("End Test case: testCase01: Verify the Leetcode Homepage URL");

    }

    public void testCase02(){

        System.out.println("Start Test case: testCase02: Verify Problem Set URL and Display First 5 Questions");

        driver.get("https://leetcode.com/");

        WebElement questionLink = driver.findElement(By.xpath("//p[normalize-space(text()) = 'View Questions']"));

        JavascriptExecutor js = (JavascriptExecutor) driver;

        js.executeScript("arguments[0].scrollIntoView(true);", questionLink);

        questionLink.click();

        String currentUrl = driver.getCurrentUrl();

        if(currentUrl.contains("problemset")){

            List<WebElement> questions = driver.findElements(By.xpath("(//a[contains(@href, '/problems/')])[position() > 1 and position() < 7]//div[contains(@class, 'ellipsis line-clamp-1')]"));
            
            for(WebElement question : questions){
                System.out.println(question.getText());
            }

            WebElement firstQuestion = driver.findElement(By.xpath("//a[contains(@href, '/problems/') and @id = '1']"));

            firstQuestion.click();

            WebElement questionTitle = driver.findElement(By.xpath("//a[contains(@href, '/problems/') and contains(@class, 'no-underline')]"));

            if(questionTitle.getText().trim().equals("1. Two Sum")){
                System.out.println("TestCase02: Retrieve details of the first 5 questions on the problems page: PASS");
            }

            else{
                System.out.println("TestCase02: Retrieve details of the first 5 questions on the problems page: FAIL");
            }

        }

        else{
                System.out.println("TestCase02: Retrieve details of the first 5 questions on the problems page: FAIL");
        }

        System.out.println("End Test case: testCase02: Verify Problem Set URL and Display First 5 Questions");

    }

    public void testCase03(){

        System.out.println("Start Test case: testCase03: Verify the Two Sum problem");

        driver.get("https://leetcode.com/");


        WebElement questionLink = driver.findElement(By.xpath("//p[normalize-space(text()) = 'View Questions']"));

        JavascriptExecutor js = (JavascriptExecutor) driver;

        js.executeScript("arguments[0].scrollIntoView(true);", questionLink);

        questionLink.click();

        WebElement firstQuestion = driver.findElement(By.xpath("//a[contains(@href, '/problems/') and @id = '1']"));

        firstQuestion.click();

        String currentUrl = driver.getCurrentUrl();

        if(currentUrl.contains("two-sum")){
            System.out.println("TestCase03: Open the Two Sum problem and verify the URL: PASS");
        }

        else{
            System.out.println("TestCase03: Open the Two Sum problem and verify the URL: FAIL");
        }

        System.out.println("End Test case: testCase03: Verify the Two Sum problem");

    }

    public void testCase04(){

        System.out.println("Start Test case: testCase04: Ensure the submissions tab displays 'Register or Login'");

        driver.get("https://leetcode.com/");


        WebElement questionLink = driver.findElement(By.xpath("//p[normalize-space(text()) = 'View Questions']"));

        JavascriptExecutor js = (JavascriptExecutor) driver;

        js.executeScript("arguments[0].scrollIntoView(true);", questionLink);

        questionLink.click();

        WebElement firstQuestion = driver.findElement(By.xpath("//a[contains(@href, '/problems/') and @id = '1']"));

        firstQuestion.click();

        WebElement submissionsTab = driver.findElement(By.xpath("//div[normalize-space(text()) = 'Submissions'][2]"));

        submissionsTab.click();

        WebElement registerLoginButton = driver.findElement(By.xpath("//a[contains(@class, 'whitespace-nowrap')]"));

        String registerLoginButtonText = registerLoginButton.getText();

        if(registerLoginButtonText.contains("Register or Log in")){
            System.out.println("TestCase04: Check the submissions tab and verify if it displays 'Register or Login': PASS");
        }

        else{
            System.out.println("TestCase04: Check the submissions tab and verify if it displays 'Register or Login': FAIL");
        }

        System.out.println("End Test case: testCase04: Ensure the submissions tab displays 'Register or Login'");

    }





}
